!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],t):t(CodeMirror)}(function(i){"use strict";var v,p,x=i.Pos;function m(t,e){for(var n,r,n=null!=(r=(n=t).flags)?r:(n.ignoreCase?"i":"")+(n.global?"g":"")+(n.multiline?"m":""),i=n,o=0;o<e.length;o++)-1==i.indexOf(e.charAt(o))&&(i+=e.charAt(o));return n==i?t:new RegExp(t.source,i)}function d(t){return/\\s|\\n|\n|\\W|\\D|\[\^/.test(t.source)}function a(t,e,n){e=m(e,"g");for(var r=n.line,i=n.ch,o=t.lastLine();r<=o;r++,i=0){e.lastIndex=i;var l=t.getLine(r),l=e.exec(l);if(l)return{from:x(r,l.index),to:x(r,l.index+l[0].length),match:l}}}function L(t,e,n){for(var r,i=0;i<=t.length;){e.lastIndex=i;var o=e.exec(t);if(!o)break;var l=o.index+o[0].length;if(l>t.length-n)break;(!r||l>r.index+r[0].length)&&(r=o),i=o.index+1}return r}function C(t,e,n){e=m(e,"g");for(var r=n.line,i=n.ch,o=t.firstLine();o<=r;r--,i=-1){var l=t.getLine(r),l=L(l,e,i<0?0:l.length-i);if(l)return{from:x(r,l.index),to:x(r,l.index+l[0].length),match:l}}}function O(t,e,n,r){if(t.length==e.length)return n;for(var i=0,o=n+Math.max(0,t.length-e.length);;){if(i==o)return i;var l=i+o>>1,h=r(t.slice(0,l)).length;if(h==n)return l;n<h?o=l:i=1+l}}function r(n,r,t,e){var i;this.atOccurrence=!1,this.doc=n,t=t?n.clipPos(t):x(0,0),this.pos={from:t,to:t},"object"==typeof e?i=e.caseFold:(i=e,e=null),"string"==typeof r?(null==i&&(i=!1),this.matches=function(t,e){return(t?function(t,e,n,r){if(!e.length)return null;var i=r?v:p,o=i(e).split(/\r|\n\r?/);t:for(var l=n.line,h=n.ch,s=t.firstLine()-1+o.length;s<=l;l--,h=-1){var f=t.getLine(l);-1<h&&(f=f.slice(0,h));var c=i(f);if(1==o.length){var u=c.lastIndexOf(o[0]);if(-1!=u)return{from:x(l,O(f,c,u,i)),to:x(l,O(f,c,u+o[0].length,i))}}else{var g=o[o.length-1];if(c.slice(0,g.length)==g){for(var a=1,n=l-o.length+1;a<o.length-1;a++)if(i(t.getLine(n+a))!=o[a])continue t;var m=t.getLine(l+1-o.length),u=i(m);if(u.slice(u.length-o[0].length)==o[0])return{from:x(l+1-o.length,O(m,u,m.length-o[0].length,i)),to:x(l,O(f,c,g.length,i))}}}}}:function(t,e,n,r){if(!e.length)return null;var i=r?v:p,o=i(e).split(/\r|\n\r?/);t:for(var l=n.line,h=n.ch,s=t.lastLine()+1-o.length;l<=s;l++,h=0){var f=t.getLine(l).slice(h),c=i(f);if(1==o.length){var u=c.indexOf(o[0]);if(-1!=u){n=O(f,c,u,i)+h;return{from:x(l,O(f,c,u,i)+h),to:x(l,O(f,c,u+o[0].length,i)+h)}}}else{var g=c.length-o[0].length;if(c.slice(g)==o[0]){for(var a=1;a<o.length-1;a++)if(i(t.getLine(l+a))!=o[a])continue t;var m=t.getLine(l+o.length-1),d=i(m),u=o[o.length-1];if(d.slice(0,u.length)==u)return{from:x(l,O(f,c,g,i)+h),to:x(l+o.length-1,O(m,d,u.length,i))}}}}})(n,r,e,i)}):(r=m(r,"gm"),e&&!1===e.multiline?this.matches=function(t,e){return(t?C:a)(n,r,e)}:this.matches=function(t,e){return(t?function(t,e,n){if(!d(e))return C(t,e,n);e=m(e,"gm");for(var r=1,i=t.getLine(n.line).length-n.ch,o=n.line,l=t.firstLine();l<=o;){for(var h=0;h<r&&l<=o;h++)var s=t.getLine(o--),f=null==f?s:s+"\n"+f;r*=2;var c=L(f,e,i);if(c){var u=f.slice(0,c.index).split("\n"),g=c[0].split("\n"),a=o+u.length,u=u[u.length-1].length;return{from:x(a,u),to:x(a+g.length-1,1==g.length?u+g[0].length:g[g.length-1].length),match:c}}}}:function(t,e,n){if(!d(e))return a(t,e,n);e=m(e,"gm");for(var r=1,i=n.line,o=t.lastLine();i<=o;){for(var l=0;l<r&&!(o<i);l++)var h=t.getLine(i++),s=null==s?h:s+"\n"+h;r*=2,e.lastIndex=n.ch;var f=e.exec(s);if(f){var c=s.slice(0,f.index).split("\n"),u=f[0].split("\n"),g=n.line+c.length-1,c=c[c.length-1].length;return{from:x(g,c),to:x(g+u.length-1,1==u.length?c+u[0].length:u[u.length-1].length),match:f}}}})(n,r,e)})}p=String.prototype.normalize?(v=function(t){return t.normalize("NFD").toLowerCase()},function(t){return t.normalize("NFD")}):(v=function(t){return t.toLowerCase()},function(t){return t}),r.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(t){for(var e=this.matches(t,this.doc.clipPos(t?this.pos.from:this.pos.to));e&&0==i.cmpPos(e.from,e.to);)t?e.from.ch?e.from=x(e.from.line,e.from.ch-1):e=e.from.line==this.doc.firstLine()?null:this.matches(t,this.doc.clipPos(x(e.from.line-1))):e.to.ch<this.doc.getLine(e.to.line).length?e.to=x(e.to.line,e.to.ch+1):e=e.to.line==this.doc.lastLine()?null:this.matches(t,x(e.to.line+1,0));if(e)return this.pos=e,this.atOccurrence=!0,this.pos.match||!0;var n=x(t?this.doc.firstLine():this.doc.lastLine()+1,0);return this.pos={from:n,to:n},this.atOccurrence=!1},from:function(){if(this.atOccurrence)return this.pos.from},to:function(){if(this.atOccurrence)return this.pos.to},replace:function(t,e){this.atOccurrence&&(t=i.splitLines(t),this.doc.replaceRange(t,this.pos.from,this.pos.to,e),this.pos.to=x(this.pos.from.line+t.length-1,t[t.length-1].length+(1==t.length?this.pos.from.ch:0)))}},i.defineExtension("getSearchCursor",function(t,e,n){return new r(this.doc,t,e,n)}),i.defineDocExtension("getSearchCursor",function(t,e,n){return new r(this,t,e,n)}),i.defineExtension("selectMatches",function(t,e){for(var n=[],r=this.getSearchCursor(t,this.getCursor("from"),e);r.findNext()&&!(0<i.cmpPos(r.to(),this.getCursor("to")));)n.push({anchor:r.from(),head:r.to()});n.length&&this.setSelections(n,0)})});